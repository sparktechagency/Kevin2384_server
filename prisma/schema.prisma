// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                    String               @id @default(auto()) @map("_id") @db.ObjectId
  avatar                String?
  email                 String               @unique
  fullName              String
  phone                 String
  password              String
  role                  UserRole
  email_verified        Boolean              @default(false)
  is_deleted            Boolean              @default(false)
  participated_sessions SessionParticipant[]
  created_sessions      Session[]

  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  

  @@map("users")
}

model Session {
  id                  String   @id @default(auto()) @map("_id") @db.ObjectId
  banner              String
  coach_id            String   @db.ObjectId
  title               String
  location            Json
  description         String
  additional_notes    String?
  address             String
  participant_min_age Int
  started_at           DateTime
  completed_at         DateTime
  max_participants    Int
  fee                 Float
  status               SessionStatus @default(CREATED)
  objectives String[]
  equipments String[]

  coach        User                 @relation(references: [id], fields: [coach_id], onDelete: Cascade)
  participants SessionParticipant[]

  refund_requests   RefundRequest[]

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("sessions")
}

model SessionParticipant {
  id             String                   @id @default(auto()) @map("_id") @db.ObjectId
  player_id      String                   @db.ObjectId
  session_id     String                   @db.ObjectId
  payment_status ParticipantPaymentStatus @default(Pending)
  payment_method PaymentMethod
  player_status  PlayerStatus @default(Attending)

  session Session @relation(references: [id], fields: [session_id], onDelete: Cascade)
  player  User    @relation(references: [id], fields: [player_id], onDelete: Cascade)
  refund_request RefundRequest?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("session_participants")
}

model RefundRequest {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  participant_id      String  @db.ObjectId @unique
  session_id        String   @db.ObjectId
  status            RefundRequestStatus  @default(Pending)

  participant  SessionParticipant  @relation(references: [id], fields: [participant_id])
  session      Session    @relation(references: [id], fields: [session_id])

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("refund_requests")
}

model SessionCancelRequest {
  id        String  @id  @default(auto())  @map("_id")  @db.ObjectId
  reason    String
  session_id  String  @db.ObjectId
  participant_id  String  @db.ObjectId
  sataus      SessionCancelRequestStatus  @default(Pending)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("cancel_requests")
}

model Otp {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  code       Int
  for        OtpFor
  email      String
  expires_in DateTime
  otp_status OtpStatus @default(CREATED)

  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@map("otps")
}

enum UserRole {
  COACH
  PLAYER
  ADMIN
}

type Coards {
  lat Float
  long  Float
}

enum RefundRequestStatus {
  Pending
  Completed
  Cancelled
  Accepted
}

enum SessionCancelRequestStatus {
  Pending
  Accepted
  Cancelled
}

enum SessionStatus {
  CREATED
  ONGOING
  COMPLETED
  CANCELLED
}

enum OtpStatus {
  CREATED
  VERIFIED
  INVALID
}

enum ParticipantPaymentStatus {
  Cash
  Paid
  Pending
  Refunded
}

enum PaymentMethod {
  ONLINE
  CASH
}

enum PlayerStatus {
  Attending
  Cancelled
}

enum OtpFor {
  Forget_Password
  Email_Verification
}
